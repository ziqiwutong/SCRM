<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scrm.service.dao.ProductDao">
    <resultMap id="cor1" type="java.util.LinkedHashMap">
        <result property="productID" column="id"/>
        <result property="productType" column="type_name"/>
        <result property="productName" column="product_name"/>
        <result property="productPrice" column="product_price"/>
        <result property="productView" column="product_view_times"/>
        <result property="productInventory" column="product_inventory"/>
        <result property="productPic" column="product_image"/>
        <result property="productIntro" column="product_intro"/>
    </resultMap>
    <resultMap id="cor2" type="java.util.LinkedHashMap">
        <result property="productID" column="id"/>
        <result property="productType" column="type_name"/>
        <result property="productName" column="product_name"/>
        <result property="productPrice" column="product_price"/>
        <result property="productView" column="product_view_times"/>
        <result property="productInventory" column="product_inventory"/>
        <result property="productPic" column="product_image"/>
        <result property="productIntro" column="product_intro"/>
        <result property="sharePerName" column="username"/>
        <result property="sharePerPhone" column="telephone"/>
        <result property="sharePerIcon" column="user_icon"/>
    </resultMap>

    <select id="queryProduct" resultMap="cor1">
        select `id`, `type_name`, `product_name`, `product_price`,
        `product_view_times`, `product_inventory`, `product_image`
        from se_product
        <where>
            <if test="a!=null and a.contains(0) and type==4">
                (product_price between 0 and 500) or
            </if>
            <if test="a!=null and a.contains(1) and type==4">
                (product_price between 500 and 1000) or
            </if>
            <if test="a!=null and a.contains(2) and type==4">
                (product_price between 1000 and 2000) or
            </if>
            <if test="a!=null and a.contains(3) and type==4">
                (product_price between 2000 and 3000) or
            </if>
            <if test="a!=null and a.contains(4) and type==4">
                product_price >=3000 or
            </if>
            <if test="a!=null and a.contains(5) and type==4">
                type_name="红酒" or
            </if>
            <if test="a!=null and a.contains(6) and type==4">
                type_name="啤酒" or
            </if>
            <if test="a!=null and a.contains(7) and type==4">
                type_name="白酒" or
            </if>
            <if test="a!=null and a.contains(8) and type==4">
                type_name="定制酒" or
            </if>
            <if test="a!=null and a.contains(9) and type==4" >
                type_name not in ('红酒','啤酒','白酒','定制酒') or
            </if>
            <if test="a!=null and a.size()>0 and type==4">
                1=3
            </if>
        </where>
        <if test="type==0">
        order by se_product.id asc

        </if>
        <if test="type==1">
            order by product_sales desc
        </if>
        <if test="type==2">
            order by product_price asc
        </if>
        <if test="type==3">
            order by product_price desc
        </if>
        <if test="pageNum != null and pageSize != null">
            limit ${(pageNum-1)*pageSize},#{pageSize}
        </if>
    </select>

    <select id="queryCount" resultType="Integer">
        select count(id) from se_product
    </select>

    <insert id="addProduct" parameterType="com.scrm.service.entity.Product">
            insert into se_product(source_id,type_id,type_name,product_name,product_price,
            product_inventory,product_image,product_intro,retail_price,
            brand,certificate,wholesale_price,price_describe)
            values(#{sourceId},#{typeId},#{typeName},#{productName},#{productPrice},
            #{productInventory},#{productImage},#{productIntro},
            #{retailPrice},#{brand},#{certificate},#{wholesalePrice},
            #{priceDescribe})
    </insert>

    <update id="editProduct" parameterType="com.scrm.service.entity.Product">
        update se_product set id=id
        <if test="typeName != null">
            ,type_name=#{typeName}
        </if>
        <if test="productName != null">
            ,product_name=#{productName}
        </if>
        <if test="productPrice != null">
            ,product_price=#{productPrice}
        </if>
        <if test="productInventory != null">
            ,product_inventory=#{productInventory}
        </if>
        <if test="productImage != null">
            ,product_image=#{productImage}
        </if>
        <if test="productIntro != null">
            ,product_intro=#{productIntro}
        </if>
        <if test="retailPrice != null">
            ,retail_price=#{retailPrice}
        </if>
        <if test="brand != null">
            ,brand=#{brand}
        </if>
        <if test="certificate != null">
            ,certificate=#{certificate}
        </if>
        <if test="wholesalePrice != null">
            ,wholesale_price=#{wholesalePrice}
        </if>
        <if test="priceDescribe != null">
            ,price_describe=#{priceDescribe}
        </if>
        where id=#{id}
    </update>

    <select id="productDetail" resultMap="cor2">
        select `type_name`,`product_name`,`product_price`,
        `product_intro`,`product_image`,brand,certificate,wholesale_price,price_describe,
        username,user_icon,telephone
        from se_product,cms_user
        where se_product.id=#{id}
        <if test="shareID!=null">
            and cms_user.id=#{shareID}
        </if>
        <if test="shareID==null">
            and cms_user.id=1
        </if>
    </select>

    <select id="queryProductByKey" resultMap="cor1">
        select `id`, `type_name`, `product_name`, `product_price`,
        `product_view_times`, `product_inventory`, `product_image`
        from se_product
        <where>

        <if test="keySearch != null">
           product_name like "%" #{keySearch} "%"
        </if>
        </where>
        order by id asc
    </select>


</mapper>